<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Mini Canva PRO</title>

<style>
body{
  font-family: Arial;
  background:#f4f6f8;
  text-align:center;
}

.toolbar{
  background:white;
  padding:10px;
  box-shadow:0 2px 6px rgba(0,0,0,0.2);
  margin-bottom:10px;
}

canvas{
  background:white;
  border:2px solid #333;
  cursor:crosshair;
}

button,input{
  margin:5px;
  padding:8px;
}
</style>
</head>

<body>

<h2>ğŸ¨ Mini Canva PRO</h2>

<div class="toolbar">
Couleur <input type="color" id="color" value="#000000">
Taille <input type="range" id="size" min="1" max="30" value="5">

<button onclick="mode='draw'">âœï¸ Dessin</button>
<button onclick="addText()">ğŸ“ Texte</button>
<button onclick="mode='rect'">â¬› Rectangle</button>
<button onclick="mode='circle'">âšª Cercle</button>

<input type="file" id="imgLoader">

<button onclick="undo()">â†©ï¸ Annuler</button>
<button onclick="clearCanvas()">ğŸ§¹ Effacer</button>
<button onclick="download()">â¬‡ï¸ TÃ©lÃ©charger</button>
</div>

<canvas id="canvas" width="700" height="450"></canvas>

<script>
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");

let drawing=false;
let mode="draw";
let history=[];

function saveState(){
  history.push(canvas.toDataURL());
}

canvas.addEventListener("mousedown",(e)=>{
  drawing=true;
  saveState();
  startX=e.offsetX;
  startY=e.offsetY;
});

canvas.addEventListener("mouseup",(e)=>{
  drawing=false;

  if(mode==="rect"){
    ctx.fillStyle=color.value;
    ctx.fillRect(startX,startY,e.offsetX-startX,e.offsetY-startY);
  }

  if(mode==="circle"){
    ctx.fillStyle=color.value;
    let r=Math.hypot(e.offsetX-startX,e.offsetY-startY);
    ctx.beginPath();
    ctx.arc(startX,startY,r,0,Math.PI*2);
    ctx.fill();
  }
});

canvas.addEventListener("mousemove",(e)=>{
  if(!drawing || mode!=="draw") return;

  ctx.fillStyle=color.value;
  ctx.beginPath();
  ctx.arc(e.offsetX,e.offsetY,size.value,0,Math.PI*2);
  ctx.fill();
});

function addText(){
  saveState();
  let text=prompt("Entre ton texte");
  if(!text) return;
  ctx.fillStyle=color.value;
  ctx.font="30px Arial";
  ctx.fillText(text,50,60);
}

function clearCanvas(){
  saveState();
  ctx.clearRect(0,0,canvas.width,canvas.height);
}

function undo(){
  if(history.length>0){
    let img=new Image();
    img.src=history.pop();
    img.onload=()=>ctx.drawImage(img,0,0);
  }
}

function download(){
  let link=document.createElement("a");
  link.download="design.png";
  link.href=canvas.toDataURL();
  link.click();
}

/* Ajouter image */
document.getElementById("imgLoader").addEventListener("change",function(e){
  saveState();
  const file=e.target.files[0];
  const reader=new FileReader();

  reader.onload=function(event){
    let img=new Image();
    img.onload=function(){
      ctx.drawImage(img,100,100,200,200);
    }
    img.src=event.target.result;
  }
  reader.readAsDataURL(file);
});
</script>

</body>
</html>
