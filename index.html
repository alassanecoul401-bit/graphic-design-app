<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>MK Design Studio</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins&family=Roboto&family=Montserrat&display=swap" rel="stylesheet">

<style>
body{
margin:0;
font-family:Poppins;
display:flex;
height:100vh;
}

/* ===== MENU ===== */
#tools{
width:230px;
background:#111;
color:white;
padding:15px;
overflow:auto;
}

button,select,input{
width:100%;
margin:6px 0;
padding:8px;
border:none;
border-radius:6px;
}

/* ===== CANVAS ===== */
#canvasContainer{
flex:1;
background:#eee;
display:flex;
justify-content:center;
align-items:center;
}

#canvas{
width:900px;
height:600px;
background:white;
position:relative;
transform-origin:center;
}

/* ===== ELEMENT ===== */
.element{
position:absolute;
cursor:move;
padding:5px;
border:1px dashed transparent;
}

.element.selected{
border:1px dashed blue;
}

.resize{
width:10px;
height:10px;
background:blue;
position:absolute;
right:-5px;
bottom:-5px;
cursor:se-resize;
}
</style>
</head>

<body>

<!-- ===== MENU GAUCHE ===== -->
<div id="tools">

<h2>ðŸŽ¨ MK Design Studio</h2>

<button onclick="addText()">Ajouter texte</button>

<select id="fontSelect" onchange="changeFont()">
<option>Poppins</option>
<option>Roboto</option>
<option>Montserrat</option>
</select>

<input type="color" onchange="changeColor(this.value)">

<button onclick="deleteElement()">ðŸ—‘ Supprimer</button>

<hr>

<button onclick="templatePoster()">ðŸ“„ ModÃ¨le Poster</button>
<button onclick="templateInstagram()">ðŸ“± ModÃ¨le Instagram</button>

<hr>

<button onclick="zoomIn()">Zoom +</button>
<button onclick="zoomOut()">Zoom -</button>

<button onclick="downloadImage()">â¬‡ TÃ©lÃ©charger PNG</button>

<input type="file" accept="image/*" onchange="addImage(event)">

</div>

<!-- ===== ZONE DESIGN ===== -->
<div id="canvasContainer">
<div id="canvas"></div>
</div>

<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

<script>
let selected=null;
let zoom=1;
const canvas=document.getElementById("canvas");

/* ===== SAUVEGARDE ===== */
function saveDesign(){
localStorage.setItem("design",canvas.innerHTML);
}

function loadDesign(){
let data=localStorage.getItem("design");
if(data){
canvas.innerHTML=data;
restoreEvents();
}
}
window.onload=loadDesign;

/* ===== TEXT ===== */
function addText(){
createText("Double clique pour modifier",50,50,"20px","#000");
}

function createText(text,x,y,size,color){
let el=document.createElement("div");
el.className="element";
el.innerText=text;
el.contentEditable=true;
el.style.left=x+"px";
el.style.top=y+"px";
el.style.fontSize=size;
el.style.color=color;

addResize(el);
addEvents(el);
canvas.appendChild(el);
saveDesign();
}

/* ===== IMAGE ===== */
function addImage(e){
let file=e.target.files[0];
let img=document.createElement("img");
img.src=URL.createObjectURL(file);
img.className="element";
img.style.width="150px";
img.style.left="80px";
img.style.top="80px";

addResize(img);
addEvents(img);
canvas.appendChild(img);
saveDesign();
}

/* ===== TEMPLATES ===== */
function templatePoster(){
canvas.innerHTML="";
createText("MON Ã‰VÃ‰NEMENT",280,80,"40px","#111");
createText("Bienvenue Ã  tous",320,200,"24px","#555");
saveDesign();
}

function templateInstagram(){
canvas.innerHTML="";
canvas.style.width="600px";
canvas.style.height="600px";
createText("PROMO -50%",180,250,"45px","red");
saveDesign();
}

/* ===== EVENTS ===== */
function addEvents(el){
el.onclick=(ev)=>{
ev.stopPropagation();
select(el);
};

let offsetX,offsetY,isDown=false;

el.onmousedown=(e)=>{
if(e.target.classList.contains("resize")) return;
isDown=true;
offsetX=e.offsetX;
offsetY=e.offsetY;
};

document.onmouseup=()=>isDown=false;

document.onmousemove=(e)=>{
if(!isDown || selected!==el) return;
el.style.left=(e.pageX-canvas.offsetLeft-offsetX)+"px";
el.style.top=(e.pageY-canvas.offsetTop-offsetY)+"px";
saveDesign();
};
}

/* ===== RESIZE ===== */
function addResize(el){
let box=document.createElement("div");
box.className="resize";
el.appendChild(box);

let resizing=false;

box.onmousedown=(e)=>{
e.stopPropagation();
resizing=true;
};

document.onmouseup=()=>resizing=false;

document.onmousemove=(e)=>{
if(!resizing || selected!==el) return;
el.style.width=e.pageX-el.offsetLeft+"px";
saveDesign();
};
}

function restoreEvents(){
document.querySelectorAll(".element").forEach(el=>{
addResize(el);
addEvents(el);
});
}

/* ===== SELECT ===== */
function select(el){
document.querySelectorAll(".element").forEach(e=>e.classList.remove("selected"));
selected=el;
el.classList.add("selected");
}

function deleteElement(){
if(selected){
selected.remove();
selected=null;
saveDesign();
}
}

/* ===== STYLE ===== */
function changeFont(){
if(selected){
selected.style.fontFamily=document.getElementById("fontSelect").value;
saveDesign();
}
}

function changeColor(color){
if(selected){
selected.style.color=color;
saveDesign();
}
}

/* ===== ZOOM ===== */
function zoomIn(){
zoom+=0.1;
canvas.style.transform="scale("+zoom+")";
}

function zoomOut(){
zoom-=0.1;
canvas.style.transform="scale("+zoom+")";
}

/* ===== DOWNLOAD ===== */
function downloadImage(){
html2canvas(canvas).then(c=>{
let link=document.createElement("a");
link.download="design.png";
link.href=c.toDataURL();
link.click();
});
}

canvas.onclick=()=>{
document.querySelectorAll(".element").forEach(e=>e.classList.remove("selected"));
selected=null;
}
</script>

</body>
</html>
